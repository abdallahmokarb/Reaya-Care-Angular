<div class="doctor-page px-6 pt-24">
  <!-- Header Banner -->
  <section class="header-banner bg-cover bg-center text-right text-black py-24">
    <div class="pr-12">
      <h2 class="text-3xl font-bold mb-2">صفحة الأطباء</h2>
      <p class="text-lg">الرئيسية / الأطباء</p>
    </div>
  </section>

  <!-- Filter Toggle for Small Screens -->
  <div class="mt-4 lg:hidden text-right">
    <button (click)="toggleFilters()" class="bg-blue-500 text-white px-4 py-2 rounded">
      عرض/إخفاء الفلاتر
    </button>
  </div>

  <!-- Main Content -->
  <div class="main-content grid grid-cols-1 lg:grid-cols-12 gap-4 mt-8">

    <!-- Sidebar Filters -->
    <div id="filterSidebar" class="col-span-12 lg:col-span-3 bg-white dark:bg-gray-800 rounded-xl shadow p-4 space-y-6 
            fixed top-0 right-0 h-full overflow-y-auto z-50 w-64 lg:static lg:w-auto 
            transform lg:transform-none transition-transform duration-300 ease-in-out 
            translate-x-full lg:translate-x-0">
      
      <!-- Close button for small screens -->
      <div class="flex justify-end lg:hidden">
        <button (click)="toggleFilters()" class="close-filter-btn text-red-500 font-bold text-xl">×</button>
      </div>

      <!-- Available Times -->
      <div>
        <h5 class="text-lg font-semibold mb-2 flex items-center gap-2 text-gray-800 dark:text-gray-100">
          <i class="fas fa-clock"></i>
          المواعيد المتاحة
        </h5>
        <div class="space-y-2">
          <label class="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              [value]="'اليوم'"
              (change)="toggleFilter(availableTimesFilters, $event)"
            /> 
            <span>اليوم</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              [value]="'غداً'"
              (change)="toggleFilter(availableTimesFilters, $event)"
            /> 
            <span>غداً</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              [value]="'أي يوم'"
              (change)="toggleFilter(availableTimesFilters, $event)"
            /> 
            <span>أي يوم</span>
          </label>
        </div>
      </div>

      <hr>

      <!-- Gender -->
      <div>
        <h5 class="text-lg font-semibold mb-2 flex items-center gap-2 text-gray-800 dark:text-gray-100">
          <i class="fas fa-venus-mars"></i>
          الجنس
        </h5>
        <div class="space-y-2">
          <label class="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              [value]="'Male'"
              (change)="toggleFilter(genderFilters, $event)"
            />
            <span>ذكر</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              [value]="'Female'"
              (change)="toggleFilter(genderFilters, $event)"
            />
            <span>أنثى</span>
          </label>
        </div>
      </div>
      <hr>

      <!-- Price Filter -->
      <div class="w-full max-w-md mx-auto my-6">
        <h5 class="text-lg font-semibold mb-2 flex items-center gap-2 text-gray-800 dark:text-gray-100">
          <i class="fas fa-money-bill-wave"></i>
          ثمن الحجز
        </h5>

        <ngx-slider
          [(value)]="priceSliderValue"
          [(highValue)]="priceSliderHighValue"
          [options]="sliderOptions"
          (userChangeEnd)="onSliderChange()">
        </ngx-slider>

        <div class="flex justify-between mt-3 text-sm text-gray-700 dark:text-gray-300 text-right">
          <div class="border border-gray-300 px-3 py-1 rounded">500 أعلى سعر</div>
          <div class="border border-gray-300 px-3 py-1 rounded">0 أقل سعر</div>
        </div>
      </div>

      <hr>

      <!-- Service Type -->
      <div>
        <h5 class="text-lg font-semibold mb-2 flex items-center gap-2 text-gray-800 dark:text-gray-100">
          <i class="fas fa-concierge-bell"></i>
          نوع الخدمة
        </h5>
        <div class="space-y-2">
          <label class="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              [value]="'InClinic'"
              (change)="toggleFilter(serviceTypesFilters, $event)"
            /> 
            <span>في العيادة</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              [value]="'OnlineConsultion'"
              (change)="toggleFilter(serviceTypesFilters, $event)"
            />
            <span>استشارة أونلاين</span>
          </label>
        </div>
      </div>

      <hr>

      <!-- Specialization Select -->
      <div>
        <label for="specializationSelect" class="block mb-2 font-semibold flex items-center gap-2 text-gray-800 dark:text-gray-100">
          <i class="fas fa-stethoscope"></i>
          التخصصات
        </label>
        <select
          id="specializationSelect"
          class="w-full border rounded p-2"
          [(ngModel)]="selectedSpecialization"
          name="specialization"
          (change)="applyFilters()"
        >
          <option [ngValue]="0">الكل</option> 
          <option *ngFor="let spec of specializations" [ngValue]="spec.specializationId">
            {{ spec.name }}
          </option>
        </select>
      </div>
      <hr>

      <!-- Government Select -->
      <div>
        <label for="governmentSelect" class="block mb-2 font-semibold flex items-center gap-2 text-gray-800">
          <i class="fas fa-map-marker-alt"></i>
          المحافظة
        </label>
        <select 
            id="governmentSelect"
            class="w-full border rounded p-2"
            [(ngModel)]="selectedGovernment"
            name="government"
            (change)="applyFilters()"
          >
          <option [ngValue]="0">الكل</option>
          <option *ngFor="let gov of governments" [ngValue]="gov.governmentId">
            {{ gov.name }}
          </option>
        </select>
      </div>
    </div>

    <!-- Doctors Section -->
    <div class="col-span-12 lg:col-span-9 bg-light dark:bg-gray-800 p-4 rounded-xl">

      <div class="flex flex-col sm:flex-row justify-between items-center bg-white dark:bg-gray-800 p-4 rounded mb-4">
        <p class="mb-2 sm:mb-0">تم العثور على {{filteredDoctors.length}} طبيب</p>
        <div class="flex items-center gap-2">
          <label for="orderBy" class="mb-0">الترتيب حسب:</label>
          <select
            class="border rounded p-1"
            name="orderBy"
            id="orderBy"
            [(ngModel)]="orderBy"
            (change)="sortDoctors()"
          >
            <option value="rating">الأعلى تقييماً</option>
            <option value="fees">الأرخص سعراً</option>
            <option value="timeslot">وقت الانتظار</option>
          </select>
        </div>
      </div>

      <div *ngIf="isLoading" class="flex items-center justify-center gap-4 h-64 text-lg font-semibold text-gray-700">
        <span>جاري تحميل الأطباء</span>
        <svg class="animate-spin h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
      </div>

      <div class="cards-section bg-white dark:bg-gray-800 rounded-xl p-4">
        <!-- Doctor cards will appear here -->
        <div id="doctorCardsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4  p-4">
          @for (doctor of filteredDoctors; track $index) {
            <div class="doctor-card font-[Cairo] flex flex-col justify-between h-full relative bg-white dark:bg-gray-950 rounded-lg shadow card-shine">
              <a [routerLink]="['/doctor-details', doctor.doctorId]">
                <div class="doctor-image" [style.backgroundImage]="'url(' + doctor.profilePictureUrl + ')'">
                  <div class="doctor-rating">
                    <span class="stars">
                      <i class="fas fa-star"></i> {{ doctor.ratingValue | number: '1.0-1' }}
                    </span>
                  </div>
                </div>
              </a>

              <!-- Doctor Info -->
              <div class="doctor-info flex-1 space-y-1 text-right dark:bg-gray-900 flex flex-col justify-between">
                <!-- Name & Availability -->
                <div>
                  <div class="flex flex-col md:flex-row lg:flex-col xl:flex-row justify-between text-right gap-1 text-sm text-gray-500 dark:text-gray-100 mb-2">
                      <div class="flex items-center gap-1 text-lg font-bold text-gray-800 dark:text-gray-50">
                        <i class="fas fa-user-md text-gray-600 dark:text-gray-50"></i>
                        {{ doctor.fullName }}
                      </div>
                      <div class="flex items-center gap-1 text-sm bg-[#15803d] p-1 rounded-lg  text-white font-medium w-fit">
                        {{ doctor.watingTime }} دقيقة انتظار
                      </div>
                  </div>

                  <!-- Specialization -->
                  <p class="text-md text-gray-700 dark:text-gray-50 mb-2 font-bold">
                    <i class="fas fa-stethoscope ml-1 text-emerald-600"></i>
                    {{ doctor.specialization }}
                  </p>

                  <!-- Service Type & Location -->
                  <div class="flex flex-col md:flex-row lg:flex-col xl:flex-row justify-between text-right gap-1 text-md font-bold text-gray-700 dark:text-gray-50 mb-2">
                    <span>
                      <i class="fas fa-clinic-medical ml-1 text-emerald-600"></i>
                      {{ doctor.doctorService == "InClinic" ? "في العيادة" : "استشارة اونلاين" }}
                    </span>
                    <span *ngIf="doctor?.addresses?.[0]">
                      <i class="fas fa-map-marker-alt ml-1 text-red-500"></i>
                      {{ doctor?.addresses?.length ? doctor.addresses[0] : '' }}
                    </span>
                  </div>


                  
                </div>

                <!-- Button -->
                <div class="pt-2 mt-auto">
                  <button
                    [routerLink]="['/doctor-details', doctor.doctorId]"
                    class="row-stack w-full flex justify-between items-center text-white py-3 px-4 rounded-lg book-btn transition bg-blue-600 hover:bg-blue-700"
                  >
                    <!-- Icon + Text -->
                    <div class="flex items-center gap-2 mb-1">
                      <i class="fas fa-calendar-check text-white text-base"></i>
                      <span class="text-base font-medium">احجز الآن</span>
                    </div>

                    <!-- Price -->
                    <div class="text-sm mt-1" >
                      <span class="px-3 py-1 rounded-lg border-1 text-white font-semibold">
                        {{ doctor.fees }} جنيه
                      </span>
                    </div>
                  </button>
                </div>

              </div>
            </div>


          }
          
        </div>
      </div>
    </div>

  </div>
</div>

