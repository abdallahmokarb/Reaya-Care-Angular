<div class="p-6">
  <div class="text-start mb-8">
    <h2
      class="text-3xl sm:text-4xl font-extrabold text-gray-800 dark:text-white leading-tight"
    >
      مركز المدفوعات الإلكترونية لرعاية
    </h2>
    <p class="text-lg sm:text-xl mt-2 text-gray-600 dark:text-gray-300">
      نظام استرداد المدفوعات
    </p>
    <p
      class="mt-4 text-base sm:text-lg text-gray-700 dark:text-gray-400 leading-relaxed"
    >
      يهدف نظام استرداد المدفوعات إلى تسهيل عملية إعادة المبالغ المالية للاعضاء
      في حال الغاء الحجز بشكل إلكتروني وآمن وفعّال، مما يضمن سرعة تنفيذ عمليات
      الاسترداد ومتابعتها بدقة، مع الحفاظ على أعلى مستويات الشفافية والموثوقية
      في التعاملات المالية.
    </p>
  </div>

  <div class="overflow-x-auto p-2">
    <table
      class="min-w-full table-auto border border-gray-300 dark:border-gray-700 rounded-lg overflow-hidden shadow-md"
    >
      <thead class="bg-green-600 text-white">
        <tr>
          <th class="px-6 py-3 text-sm font-semibold text-center">رقم الحجز</th>
          <th class="px-6 py-3 text-sm font-semibold text-center">الدكتور</th>
          <th class="px-6 py-3 text-sm font-semibold text-center">التخصص</th>
          <th class="px-6 py-3 text-sm font-semibold text-center">من</th>
          <th class="px-6 py-3 text-sm font-semibold text-center">إلى</th>
          <th class="px-6 py-3 text-sm font-semibold text-center">التاريخ</th>
          <th class="px-6 py-3 text-sm font-semibold text-center">الحالة</th>
          <th class="px-6 py-3 text-sm font-semibold text-center">المعاملة</th>
          <th class="px-6 py-3 text-sm font-semibold text-center">المبلغ</th>
          <th class="px-6 py-3 text-sm font-semibold text-center">
            طلب استرداد
          </th>
        </tr>
      </thead>

      <tbody>
        <tr
          *ngFor="let appointment of filteredAppointments"
          class="bg-white dark:bg-gray-900 border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition"
        >
          <td
            class="px-6 py-4 text-sm text-center text-gray-800 dark:text-white"
          >
            {{ appointment.appointmentId }}
          </td>
          <td
            class="px-6 py-4 text-sm text-center text-gray-800 dark:text-white"
          >
            {{ appointment.doctorName }}
          </td>
          <td
            class="px-6 py-4 text-sm text-center text-gray-800 dark:text-white"
          >
            {{ appointment.specializationName }}
          </td>
          <td
            class="px-6 py-4 text-sm text-center text-gray-800 dark:text-white"
          >
            {{ appointment.startTime | date: 'shortTime' }}
          </td>
          <td
            class="px-6 py-4 text-sm text-center text-gray-800 dark:text-white"
          >
            {{ appointment.endTime | date: 'shortTime' }}
          </td>

          <td
            class="px-6 py-4 text-sm text-center text-gray-800 dark:text-white"
          >
            {{ appointment.date | date:'yyyy-MM-dd' }}
          </td>

          <!-- الحالة -->
          <td class="px-6 py-4 text-sm text-center">
            <span
              [ngClass]="{
            'bg-green-100 text-green-800': appointment.status === 'Confirmed',
            'bg-red-100 text-red-800': appointment.status === 'Cancelled',
            'bg-yellow-100 text-yellow-800': appointment.status === 'NonAttendance',
            'bg-gray-100 text-gray-800': appointment.status !== 'Confirmed' && appointment.status !== 'Cancelled' && appointment.status !== 'NonAttendance'
          }"
              class="px-3 py-1 rounded-full text-xs font-semibold"
            >
              {{ appointment.status }}
            </span>
          </td>

          <td
            class="px-6 py-4 text-sm text-center text-gray-800 dark:text-white"
          >
            {{ appointment.transactionId }}
          </td>
          <td
            class="px-6 py-4 text-sm text-center text-gray-800 dark:text-white"
          >
            {{ appointment.amount }} ج
          </td>
          <td class="px-6 py-4 text-sm text-center">
            <button
              class="bg-green-500 hover:bg-green-600 text-white px-4 py-1 rounded text-sm cursor-pointer"
              (click)="openRefundModal(appointment)"
            >
              استرداد
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div
    *ngIf="errorMessage"
    class="text-red-600 bg-red-100 border border-red-400 p-3 rounded mt-4"
  >
    {{ errorMessage }}
  </div>
  <ng-template #noPayments>
    <div
      class="flex flex-col items-center justify-center min-h-[400px] bg-white dark:bg-gray-800 rounded-xl shadow-md p-6"
    >
      <h2 class="text-2xl font-bold mb-4 dark:text-white">مدفوعاتي</h2>
      <img
        src="https://cdn3d.iconscout.com/3d/premium/thumb/debit-card-5296099-4431733.png"
        alt="No Bookings"
        class="w-40 h-40 mb-6 opacity-80"
      />
      <p class="text-gray-500 text-lg text-center dark:text-gray-300">
        لا يوجد أي مدفوعات لك حالياً
      </p>
    </div>
  </ng-template>

  <!-- Refund Confirmation Modal -->
  <div
    *ngIf="selectedAppointment"
    class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50"
  >
    <div
      class="bg-white dark:bg-gray-900 rounded-2xl p-6 shadow-2xl max-w-md w-full border-t-4 border-green-600"
    >
      <!-- Header -->
      <div class="flex items-center mb-5">
        <svg
          class="w-10 h-10 text-green-600 mr-3"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <h3 class="text-2xl font-bold text-gray-800 dark:text-white">
          هل ترغب في استرداد المبلغ؟
        </h3>
      </div>

      <!-- Message -->
      <p class="text-gray-700 dark:text-gray-300 mb-3 leading-relaxed">
        سيتم تقديم طلب لاسترداد مبلغ
        <strong class="text-green-700 dark:text-green-400 text-lg">
          {{ selectedAppointment.amount }} جنيه
        </strong>
        الخاص بالمعاملة رقم
        <strong class="text-green-600 dark:text-green-400">
          {{ selectedAppointment.transactionId }}
        </strong>
        والمرتبطة بالحجز رقم
        <strong class="text-green-600 dark:text-green-400">
          {{ selectedAppointment.appointmentId }}
        </strong>
      </p>

      <!-- Info -->
      <p class="text-gray-600 dark:text-gray-400 mb-3 text-sm">
        ستتم معالجة الاسترداد عبر نفس وسيلة الدفع المستخدمة وهي بطاقة مصرفية /
        ائتمانية اخر ارقامها 4242 *** **** **** ***.
      </p>

      <!-- Notice -->
      <div
        class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 p-3 rounded-lg text-sm mb-6 flex items-start"
      >
        <svg
          class="w-5 h-5 mr-2 mt-0.5"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z"
          />
        </svg>
        <span>
          <strong>ملاحظة:</strong> ظهور المبلغ المسترد في حسابك قد يستغرق حتى
          <strong>3 أيام عمل</strong> حسب البنك .
        </span>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end gap-3">
        <button
          class="px-4 py-2 bg-gray-100 cursor-pointer dark:bg-gray-700 text-gray-800 dark:text-white rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition"
          (click)="closeRefundModal()"
        >
          إلغاء
        </button>
        <button
          class="px-4 py-2 bg-green-600 cursor-pointer text-white rounded-lg hover:bg-green-700 transition font-medium"
          (click)="confirmRefund()"
        >
          تأكيد الاسترداد
        </button>
      </div>
    </div>
  </div>
</div>
