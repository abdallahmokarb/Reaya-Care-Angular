<div class="min-h-screen flex flex-col dark:bg-gray-950" dir="rtl">
  <!-- Main Content Container -->
  <div class="flex-1 flex flex-col items-center p-4 gap-6 max-w-6xl mx-auto w-full">

    <!-- Profile Card - Centered at Top -->
    <div class="w-full bg-white dark:bg-gray-900 shadow-2xl rounded-2xl overflow-hidden">
      <!-- Header Section -->
      <div class="bg-green-600 p-6 text-white flex flex-col md:flex-row items-center gap-6">
        @if(!docInfoResponseUrl.ProfileImage) {
        <img src="/assets/images/avatar.jpg"
        class="w-32 h-32 rounded-full border-4 border-white shadow-md object-cover"
        alt="صورة الطبيب" (click)="fileInput.click()" />
          <input type="file" (change)="uploadProfileImage($event)" class="hidden" #fileInput />
        }@else {
          <img [src]="docInfoResponseUrl.ProfileImage" class="w-32 h-32 rounded-full border-4 border-white shadow-md object-cover" alt="صورة الطبيب" (click)="fileEdit.click()" />
          <input type="file" (change)="editProfileImage($event)" class="hidden" #fileEdit />
        }
        <div class="text-center md:text-right">
          <h2 class="text-3xl font-bold">{{ doctor?.fullName }}</h2>
          <p class="text-green-200 mt-1 text-sm">التخصص: {{ doctor?.specialization || 'غير محدد' }}</p>

          <ng-container *ngIf="doctor?.service === 'InClinic'; else onlineOrUnknown">
            <p class="text-green-200 mt-1 text-sm">نوع الخدمة: عيادة</p>
          </ng-container>
          <ng-template #onlineOrUnknown>
            <p class="text-green-200 mt-1 text-sm">
              نوع الخدمة:
              {{ doctor?.service === 'OnlineConsultion' ? 'أونلاين' : 'غير محدد' }}
            </p>
          </ng-template>
          <p class="text-sm mt-2">
            @if(doctor?.gender === 'Female') {
              الجنس: أنثى
            } @else if(doctor?.gender === 'Male') {
              الجنس: ذكر
            }
          </p>
          <p class="text-sm">
            <span class="font-semibold">العنوان</span> {{ doctor.governmentName || 'غير محدد' }}, {{ doctor.cityName || 'غير محدد' }}
          </p>
         
          <p class="text-sm">
            الحالة:
            <span [ngClass]="doctor?.status === 1 ? 'text-green-300' : 'text-red-300'">
              {{ doctor?.status === 1 ? 'نشط' : 'غير نشط' }}
            </span>
          </p>
        </div>
      </div>

      <!-- Contact Section -->
      <div class="p-6 border-b border-gray-200 dark:border-gray-800">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">معلومات التواصل</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 dark:text-gray-200">
          <p><strong>البريد الإلكتروني:</strong> {{ doctor?.email }}</p>
          <p><strong>رقم الهاتف:</strong> {{ doctor?.phoneNumber }}</p>
          <!-- <p><strong>العنوان:</strong> {{ doctor?.detailedAddress || 'غير محدد' }}</p>
          <p><strong>الموقع:</strong> {{ doctor?.location || 'غير محدد' }}</p> -->
          <p><strong>العنوان:</strong>
          <a [href]="doctor?.location">
            {{ doctor?.detailedAddress || 'غير محدد' }}
          </a>
        </div>
      </div>

      <!-- Professional Section -->
      <div class="p-6 border-b border-gray-200 dark:border-gray-800">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">المعلومات المهنية</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 dark:text-gray-200">
          <p><strong>سنوات الخبرة:</strong> {{ doctor?.expYears }}</p>
          <p><strong>التقييم:</strong> {{ doctor?.ratingValue }} / 5</p>
          <p><strong>الأجر:</strong> {{ doctor?.fees }} جنيه</p>
          <p><strong>الرصيد:</strong> {{ doctor?.balance }} جنيه</p>
        </div>
      </div>

      <!-- About Me Section -->
      <div class="p-6">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">نبذة عني</h3>
        <p class="text-gray-700 dark:text-gray-200 leading-relaxed">{{ doctor?.aboutMe }}</p>
      </div>

      <!-- Edit Button -->
      <div class="p-6 bg-gray-50 dark:bg-gray-800 text-left">
        <button (click)="openEditModal()"
                class="bg-green-600 text-white px-6 py-2 rounded-lg shadow hover:bg-green-700 transition-all">
          تعديل الملف الشخصي
        </button>
      </div>
    </div>

    <!-- Documents Upload Section - Below Profile -->
    <div class="w-full space-y-6">
      <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4 text-center">تحميل المستندات</h3>
      
      <!-- Document Cards Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Medical License -->
        <div class="bg-white dark:bg-gray-900 shadow-lg rounded-xl p-6 border border-gray-200 dark:border-gray-700">
          <div class="flex flex-col gap-3">
            <label class="font-semibold text-lg text-gray-800 dark:text-gray-200">رخصة المزاولة الطبية</label>

            <form *ngIf="!doctor?.medicalLicenseUrl && !docInfoResponseUrl.medicalLicense" (ngSubmit)="uploadFile('MedicalLicense')" class="flex flex-col gap-2">
              <label class="flex items-center gap-3 px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12v9m0-9L8 16m4-4l4 4M12 4v8" />
                </svg>
                <span class="text-sm text-gray-700 dark:text-gray-300">اختر ملفاً من جهازك</span>
                <svg *ngIf="selectedFiles['medicalLicense']" class="w-5 h-5 text-green-500 ml-2" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                </svg>
                <input type="file" (change)="onFileSelect($event, 'MedicalLicense')" class="hidden" />
              </label>
              <button type="submit" class="self-start bg-blue-600 text-white px-4 py-1.5 rounded-md hover:bg-blue-700 transition">رفع الملف</button>
            </form>

            <div *ngIf="doctor?.medicalLicenseUrl || docInfoResponseUrl.medicalLicense" class="flex flex-col gap-2">
              <div class="text-sm text-green-700 dark:text-green-300">
                تم رفع الملف:
                <a [href]="docInfoResponseUrl.medicalLicense" target="_blank" class="underline hover:text-green-900">عرض الملف</a>
              </div>
              <form (ngSubmit)="editFile('MedicalLicense')" class="flex flex-col gap-2">
                <label class="flex items-center gap-3 px-4 py-2 bg-white dark:bg-gray-800 border border-yellow-400 rounded-lg shadow-sm cursor-pointer hover:bg-yellow-100 dark:hover:bg-yellow-600 transition">
                  <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v16h16V4H4zm4 4h8v2H8V8zm0 4h8v2H8v-2z" />
                  </svg>
                  <span class="text-sm text-gray-700 dark:text-gray-200">اختيار ملف جديد للتعديل</span>
                  <input type="file" (change)="onFileSelect($event, 'MedicalLicense')" class="hidden" />
                </label>
                <button type="submit" class="self-start bg-yellow-500 text-white px-4 py-1.5 rounded-md hover:bg-yellow-600 transition">تعديل الملف</button>
              </form>
            </div>
          </div>
        </div>

        <!-- National ID -->
        <div class="bg-white dark:bg-gray-900 shadow-lg rounded-xl p-6 border border-gray-200 dark:border-gray-700">
          <div class="flex flex-col gap-3">
            <label class="font-semibold text-lg text-gray-800 dark:text-gray-200">الرقم القومي</label>

            <form *ngIf="!doctor?.nationalIdUrl && !docInfoResponseUrl.nationalId" (ngSubmit)="uploadFile('NationalId')" class="flex flex-col gap-2">
              <label class="flex items-center gap-3 px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12v9m0-9L8 16m4-4l4 4M12 4v8" />
                </svg>
                <span class="text-sm text-gray-700 dark:text-gray-300">اختر ملفاً من جهازك</span>
                <svg *ngIf="selectedFiles['nationalId']" class="w-5 h-5 text-green-500 ml-2" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                </svg>
                <input type="file" (change)="onFileSelect($event, 'NationalId')" class="hidden" />
              </label>
              <button type="submit" class="self-start bg-blue-600 text-white px-4 py-1.5 rounded-md hover:bg-blue-700 transition">رفع الملف</button>
            </form>

            <div *ngIf="doctor?.nationalIdUrl || docInfoResponseUrl.nationalId" class="flex flex-col gap-2">
              <div class="text-sm text-green-700 dark:text-green-300">
                تم رفع الملف:
                <a [href]="docInfoResponseUrl.nationalId" target="_blank" class="underline hover:text-green-900">عرض الملف</a>
              </div>
              <form (ngSubmit)="editFile('NationalId')" class="flex flex-col gap-2">
                <label class="flex items-center gap-3 px-4 py-2 bg-white dark:bg-gray-800 border border-yellow-400 rounded-lg shadow-sm cursor-pointer hover:bg-yellow-100 dark:hover:bg-yellow-600 transition">
                  <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v16h16V4H4zm4 4h8v2H8V8zm0 4h8v2H8v-2z" />
                  </svg>
                  <span class="text-sm text-gray-700 dark:text-gray-200">اختيار ملف جديد للتعديل</span>
                  <input type="file" (change)="onFileSelect($event, 'NationalId')" class="hidden" />
                </label>
                <button type="submit" class="self-start bg-yellow-500 text-white px-4 py-1.5 rounded-md hover:bg-yellow-600 transition">تعديل الملف</button>
              </form>
            </div>
          </div>
        </div>

        <!-- Graduation Certificate -->
        <div class="bg-white dark:bg-gray-900 shadow-lg rounded-xl p-6 border border-gray-200 dark:border-gray-700">
          <div class="flex flex-col gap-3">
            <label class="font-semibold text-lg text-gray-800 dark:text-gray-200">شهادة التخرج</label>

            <form *ngIf="!doctor?.graduationCertificateUrl && !docInfoResponseUrl.graduationCertificate" (ngSubmit)="uploadFile('GraduationCertificate')" class="flex flex-col gap-2">
              <label class="flex items-center gap-3 px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12v9m0-9L8 16m4-4l4 4M12 4v8" />
                </svg>
                <span class="text-sm text-gray-700 dark:text-gray-300">اختر ملفاً من جهازك</span>
                <svg *ngIf="selectedFiles['GraduationCertificate']" class="w-5 h-5 text-green-500 ml-2" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                </svg>
                <input type="file" (change)="onFileSelect($event, 'GraduationCertificate')" class="hidden" />
              </label>
              <button type="submit" class="self-start bg-blue-600 text-white px-4 py-1.5 rounded-md hover:bg-blue-700 transition">رفع الملف</button>
            </form>

            <div *ngIf="doctor?.graduationCertificateUrl || docInfoResponseUrl?.graduationCertificate" class="flex flex-col gap-2">
              <div class="text-sm text-green-700 dark:text-green-300">
                تم رفع الملف:
                <a [href]="docInfoResponseUrl.graduationCertificate" target="_blank" class="underline hover:text-green-900">عرض الملف</a>
              </div>
              <form (ngSubmit)="editFile('GraduationCertificate')" class="flex flex-col gap-2">
                <label class="flex items-center gap-3 px-4 py-2 bg-white dark:bg-gray-800 border border-yellow-400 rounded-lg shadow-sm cursor-pointer hover:bg-yellow-100 dark:hover:bg-yellow-600 transition">
                  <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v16h16V4H4zm4 4h8v2H8V8zm0 4h8v2H8v-2z" />
                  </svg>
                  <span class="text-sm text-gray-700 dark:text-gray-200">اختيار ملف جديد للتعديل</span>
                  <input type="file" (change)="onFileSelect($event, 'GraduationCertificate')" class="hidden" />
                </label>
                <button type="submit" class="self-start bg-yellow-500 text-white px-4 py-1.5 rounded-md hover:bg-yellow-600 transition">تعديل الملف</button>
              </form>
            </div>
          </div>
        </div>

        <!-- Experience Certificate -->
        <div class="bg-white dark:bg-gray-900 shadow-lg rounded-xl p-6 border border-gray-200 dark:border-gray-700">
          <div class="flex flex-col gap-3">
            <label class="font-semibold text-lg text-gray-800 dark:text-gray-200">شهادة الخبرة</label>

            <form *ngIf="!doctor?.experienceCertificateUrl && !docInfoResponseUrl?.experienceCertificate" (ngSubmit)="uploadFile('ExperienceCertificate')" class="flex flex-col gap-2">
              <label class="flex items-center gap-3 px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12v9m0-9L8 16m4-4l4 4M12 4v8" />
                </svg>
                <span class="text-sm text-gray-700 dark:text-gray-300">اختر ملفاً من جهازك</span>
                <svg *ngIf="selectedFiles['ExperienceCertificate']" class="w-5 h-5 text-green-500 ml-2" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                </svg>
                <input type="file" (change)="onFileSelect($event, 'ExperienceCertificate')" class="hidden" />
              </label>
              <button type="submit" class="self-start bg-blue-600 text-white px-4 py-1.5 rounded-md hover:bg-blue-700 transition">رفع الملف</button>
            </form>

            <div *ngIf="doctor?.experienceCertificateUrl || docInfoResponseUrl?.experienceCertificate" class="flex flex-col gap-2">
              <div class="text-sm text-green-700 dark:text-green-300">
                تم رفع الملف:
                <a [href]="docInfoResponseUrl.experienceCertificate" target="_blank" class="underline hover:text-green-900">عرض الملف</a>
              </div>
              <form (ngSubmit)="editFile('ExperienceCertificate')" class="flex flex-col gap-2">
                <label class="flex items-center gap-3 px-4 py-2 bg-white dark:bg-gray-800 border border-yellow-400 rounded-lg shadow-sm cursor-pointer hover:bg-yellow-100 dark:hover:bg-yellow-600 transition">
                  <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v16h16V4H4zm4 4h8v2H8V8zm0 4h8v2H8v-2z" />
                  </svg>
                  <span class="text-sm text-gray-700 dark:text-gray-200">اختيار ملف جديد للتعديل</span>
                  <input type="file" (change)="onFileSelect($event, 'ExperienceCertificate')" class="hidden" />
                </label>
                <button type="submit" class="self-start bg-yellow-500 text-white px-4 py-1.5 rounded-md hover:bg-yellow-600 transition">تعديل الملف</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
 <div *ngIf="editMode" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow-lg w-full max-w-lg max-h-[90vh] overflow-y-auto">
    <h2 class="text-lg font-bold mb-4 text-green-600 dark:text-green-400">تعديل بيانات الطبيب</h2>
    <form [formGroup]="editForm" (ngSubmit)="submitEdit()" class="space-y-3 text-sm">

      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="block mb-1">الاسم الكامل</label>
          <input formControlName="fullName" class="w-full rounded border px-2 py-1" />
        </div>
        <div>
          <label class="block mb-1">رقم الهاتف</label>
          <input formControlName="phoneNumber" class="w-full rounded border px-2 py-1" />
        </div>
        <div>
          <label class="block mb-1">البريد الإلكتروني</label>
          <input formControlName="email" class="w-full rounded border px-2 py-1" />
        </div>
        <div>
          <label class="block mb-1">التخصص</label>
          <select formControlName="specializationId" class="w-full rounded border px-2 py-1">
            <option value="">اختر التخصص</option>
            <option *ngFor="let spec of specializations" [value]="spec.specializationId">{{ spec.name }}</option>
          </select>
        </div>
        <div>
        <label class="block mb-1">المحافظة</label>
        <select (change)="onChangeGovernment($event)" formControlName="governmentId" class="w-full rounded border px-2 py-1">
          <option value="">اختر المحافظة</option>
          <option *ngFor="let gov of governments" [value]="gov.governmentId">{{ gov.name }}</option>
        </select>
      </div> 
         <div>
        <label class="block mb-1">المدينة</label>
        <select formControlName="cityId" class="w-full rounded border px-2 py-1">
          <option value="">اختر المدينة</option>
          <option *ngFor="let city of cities" [value]="city.cityId">{{ city.name }}</option>
        </select>
      </div>    
        <div>
          <label class="block mb-1">الأجر</label>
          <input formControlName="fees" type="number" class="w-full rounded border px-2 py-1" />
        </div>
        <div>
          <label class="block mb-1">سنوات الخبرة</label>
          <input formControlName="expYears" class="w-full rounded border px-2 py-1" />
        </div>
      </div>

      <!-- Gender (full width) -->
      <div>
        <label class="block mb-1">الجنس</label>
        <div class="flex gap-4">
          <label class="flex items-center gap-1"><input type="radio" formControlName="gender" [value]="'Male'" /> ذكر</label>
          <label class="flex items-center gap-1"><input type="radio" formControlName="gender" [value]="'Female'" /> أنثى</label>
        </div>
      </div>

      <!-- Service Type (full width) -->
      <div>
        <label class="block mb-1">نوع الخدمة</label>
        <div class="flex gap-4">
          <label class="flex items-center gap-1"><input type="radio" formControlName="service" [value]="1" /> عيادة</label>
          <label class="flex items-center gap-1"><input type="radio" formControlName="service" [value]="2" /> أونلاين</label>
        </div>
      </div>
      
      
   

      <!-- Clinic details -->
      <div *ngIf="editForm.get('service')?.value == 1" class="grid grid-cols-2 gap-3">
        <div>
          <label class="block mb-1">العنوان</label>
          <input formControlName="detailedAddress" class="w-full rounded border px-2 py-1" />
        </div>
        <div>
          <label class="block mb-1">الموقع على الخريطة</label>
          <div class="flex-column">
            <input
              formControlName="location"
              class="w-full rounded border px-2 py-1 mb-2"
              readonly
            />
            <button
              type="button"
              (click)="toggleMap()"
              class="px-3 py-1 bg-blue-600 text-white rounded"
            >
              @if(!showMap)
              {
              اختر من الخريطة

              }
              @else {
                تراجع
              }
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="showMap" class="mt-4 border rounded p-2 ">
          <app-map-picker (locationSelected)="onLocationSelected($event)"></app-map-picker>
      </div>

      <!-- About me -->
      <div>
        <label class="block mb-1">نبذة عني</label>
        <textarea formControlName="aboutMe" rows="2" class="w-full rounded border px-2 py-1"></textarea>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end gap-2 pt-2">
        <button type="button" (click)="closeEditModal()" class="px-3 py-1 rounded bg-gray-300 dark:bg-gray-700">إلغاء</button>
        <button type="submit" class="px-3 py-1 rounded bg-green-600 text-white">حفظ</button>
      </div>

    </form>
  </div>
</div>
